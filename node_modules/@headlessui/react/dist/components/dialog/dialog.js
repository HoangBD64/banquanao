"use client";import l,{createContext as me,createRef as ce,useContext as Y,useEffect as De,useMemo as _,useReducer as Pe,useRef as J,useState as ye}from"react";import{useEvent as c}from'../../hooks/use-event.js';import{useEventListener as Ee}from'../../hooks/use-event-listener.js';import{useId as L}from'../../hooks/use-id.js';import{useInertOthers as Ce}from'../../hooks/use-inert-others.js';import{useIsTouchDevice as Ae}from'../../hooks/use-is-touch-device.js';import{useOnDisappear as _e}from'../../hooks/use-on-disappear.js';import{useOutsideClick as Fe}from'../../hooks/use-outside-click.js';import{useOwnerDocument as be}from'../../hooks/use-owner.js';import{useRootContainers as Re}from'../../hooks/use-root-containers.js';import{useScrollLock as ve}from'../../hooks/use-scroll-lock.js';import{useServerHandoffComplete as Se}from'../../hooks/use-server-handoff-complete.js';import{useSyncRefs as h}from'../../hooks/use-sync-refs.js';import{CloseProvider as xe}from'../../internal/close-provider.js';import{HoistFormFields as Le}from'../../internal/form-fields.js';import{State as F,useOpenClosed as he}from'../../internal/open-closed.js';import{ForcePortalRoot as X}from'../../internal/portal-force-root.js';import{StackMessage as B,StackProvider as Oe}from'../../internal/stack-context.js';import{match as O}from'../../utils/match.js';import{RenderFeatures as K,forwardRefWithAs as I,render as w}from'../../utils/render.js';import{Description as V,useDescriptions as Ie}from'../description/description.js';import{FocusTrap as we,FocusTrapFeatures as T}from'../focus-trap/focus-trap.js';import{Keys as Me}from'../keyboard.js';import{Portal as q,useNestedPortals as Ge}from'../portal/portal.js';var He=(r=>(r[r.Open=0]="Open",r[r.Closed=1]="Closed",r))(He||{}),Ne=(t=>(t[t.SetTitleId=0]="SetTitleId",t))(Ne||{});let ke={[0](o,t){return o.titleId===t.id?o:{...o,titleId:t.id}}},b=me(null);b.displayName="DialogContext";function M(o){let t=Y(b);if(t===null){let r=new Error(`<${o} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,M),r}return t}function Ue(o,t){return O(t.type,ke,o,t)}let $e="div",je=K.RenderStrategy|K.Static;function We(o,t){let r=L(),{id:d=`headlessui-dialog-${r}`,open:i,onClose:s,initialFocus:f,role:a="dialog",autoFocus:D=!0,__demoMode:p=!1,...G}=o,[R,H]=ye(0),N=J(!1);a=function(){return a==="dialog"||a==="alertdialog"?a:(N.current||(N.current=!0,console.warn(`Invalid role [${a}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog")}();let P=he();i===void 0&&P!==null&&(i=(P&F.Open)===F.Open);let u=J(null),z=h(u,t),y=be(u),k=o.hasOwnProperty("open")||P!==null,U=o.hasOwnProperty("onClose");if(!k&&!U)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!k)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!U)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(typeof i!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${i}`);if(typeof s!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${s}`);let n=i?0:1,[E,Q]=Pe(Ue,{titleId:null,descriptionId:null,panelRef:ce()}),m=c(()=>s(!1)),$=c(e=>Q({type:0,id:e})),v=Se()?n===0:!1,C=R>1,Z=Y(b)!==null,[ee,te]=Ge(),oe={get current(){var e;return(e=E.panelRef.current)!=null?e:u.current}},{resolveContainers:S,mainTreeNodeRef:re,MainTreeNode:le}=Re({portals:ee,defaultContainers:[oe]}),ne=C?"parent":"leaf",j=P!==null?(P&F.Closing)===F.Closing:!1,ae=(()=>C||j?!1:v)();Ce({allowed:c(()=>{var e,g;return[(g=(e=u.current)==null?void 0:e.closest("[data-headlessui-portal]"))!=null?g:null]}),disallowed:c(()=>{var e,g;return[(g=(e=re.current)==null?void 0:e.closest("body > *:not(#headlessui-portal-root)"))!=null?g:null]})},p?!1:ae);let ie=(()=>!(!v||C))();Fe(S,e=>{e.preventDefault(),m()},ie);let se=(()=>!(C||n!==0))();Ee(y==null?void 0:y.defaultView,"keydown",e=>{se&&(e.defaultPrevented||e.key===Me.Escape&&(e.preventDefault(),e.stopPropagation(),document.activeElement&&"blur"in document.activeElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur(),m()))});let pe=(()=>!(j||n!==0||Z))();ve(y,p?!1:pe,S),_e(u,m,n===0);let[ue,de]=Ie(),fe=_(()=>[{dialogState:n,close:m,setTitleId:$},E],[n,E,m,$]),W=_(()=>({open:n===0}),[n]),ge={ref:z,id:d,role:a,tabIndex:-1,"aria-modal":p?void 0:n===0?!0:void 0,"aria-labelledby":E.titleId,"aria-describedby":ue},Te=!Ae(),A=v?O(ne,{parent:T.RestoreFocus,leaf:T.All&~T.FocusLock}):T.None;return D&&(A|=T.AutoFocus),Te||(A&=~T.InitialFocus),p&&(A=T.None),l.createElement(Oe,{type:"Dialog",enabled:n===0,element:u,onUpdate:c((e,g)=>{g==="Dialog"&&O(e,{[B.Add]:()=>H(x=>x+1),[B.Remove]:()=>H(x=>x-1)})})},l.createElement(X,{force:!0},l.createElement(q,null,l.createElement(b.Provider,{value:fe},l.createElement(q.Group,{target:u},l.createElement(X,{force:!1},l.createElement(de,{slot:W,name:"Dialog.Description"},l.createElement(te,null,l.createElement(we,{initialFocus:f,initialFocusFallback:p?void 0:u,containers:S,features:A},l.createElement(xe,{value:m},w({ourProps:ge,theirProps:G,slot:W,defaultTag:$e,features:je,visible:n===0,name:"Dialog"})))))))))),l.createElement(Le,null,l.createElement(le,null)))}let Ye="div";function Je(o,t){let r=L(),{id:d=`headlessui-dialog-panel-${r}`,...i}=o,[{dialogState:s},f]=M("Dialog.Panel"),a=h(t,f.panelRef),D=_(()=>({open:s===0}),[s]),p=c(R=>{R.stopPropagation()});return w({ourProps:{ref:a,id:d,onClick:p},theirProps:i,slot:D,defaultTag:Ye,name:"Dialog.Panel"})}let Xe="h2";function Be(o,t){let r=L(),{id:d=`headlessui-dialog-title-${r}`,...i}=o,[{dialogState:s,setTitleId:f}]=M("Dialog.Title"),a=h(t);De(()=>(f(d),()=>f(null)),[d,f]);let D=_(()=>({open:s===0}),[s]);return w({ourProps:{ref:a,id:d},theirProps:i,slot:D,defaultTag:Xe,name:"Dialog.Title"})}let Ke=I(We),Ve=I(Je),qe=I(Be),At=V,_t=Object.assign(Ke,{Panel:Ve,Title:qe,Description:V});export{_t as Dialog,At as DialogDescription,Ve as DialogPanel,qe as DialogTitle};
